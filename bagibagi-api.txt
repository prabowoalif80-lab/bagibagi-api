const express = require("express");
const crypto = require("crypto");
const axios = require("axios");

const app = express();

// ==== DATA DARI KAMU ====
const merchantCode = "bagibagi-U89XVVIZaL";
const secretKey = "bagibagi-FRg7iREJ0OaGgVxy14hv";
const endpoint = "/api/partnerintegration/top-donator";

// Fungsi buat token
function makeToken() {
    const raw = merchantCode + secretKey + endpoint;
    return crypto.createHash("md5").update(raw).digest("hex");
}

// Route API kamu
app.get("/topdonator", async (req, res) => {
    const token = makeToken();

    const url = `https://bagibagi.co${endpoint}?merchantCode=${merchantCode}&token=${token}`;

    try {
        const response = await axios.get(url);
        res.json(response.data);
    } catch (err) {
        res.json({ error: err.message });
    }
});

// Jalankan server
app.listen(3000, () => {
    console.log("API berjalan di port 3000");
});
